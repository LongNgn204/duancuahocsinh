name = "ban-dong-hanh-worker"
main = "workers/router.js"
compatibility_date = "2024-12-01"
workers_dev = true
preview_urls = true

# Workers AI binding (chỉ dùng cho embeddings/RAG, chat chuyển sang frontend Gemini)
[ai]
binding = "AI"

# D1 Database binding
# Chú thích: Chạy `wrangler d1 create ban-dong-hanh-db` để tạo database
# Sau đó cập nhật database_id bên dưới
[[d1_databases]]
binding = "ban_dong_hanh_db"
database_name = "ban-dong-hanh-db"
database_id = "a6a814eb-b5fb-4626-9258-f519060d8c89"

# Durable Objects cho Voice Call WebSocket proxy
# Chú thích: Durable Objects hỗ trợ outbound WebSocket để proxy đến OpenAI Realtime API
[durable_objects]
bindings = [
  { name = "VOICE_CALL_SESSION", class_name = "VoiceCallSessionOpenAI" }
]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["VoiceCallSession"]

[[migrations]]
tag = "v2"
renamed_classes = [{ from = "VoiceCallSession", to = "VoiceCallSessionOpenAI" }]

[vars]
# CORS origin allow-list
ALLOW_ORIGIN = "http://localhost:5173,https://duancuahocsinh.pages.dev,*.bandonghanh.pages.dev"
# Workers AI model (chỉ dùng cho embeddings, KHÔNG dùng cho chat)
# Chat sử dụng OpenAI ChatGPT (gpt-4o-mini) - xem ai-proxy.js
MODEL = "@cf/meta/llama-3.1-8b-instruct"
# Token limit hàng tháng
MONTHLY_TOKEN_LIMIT = "500000"
# Token budget hàng ngày cho AI (kiểm soát chi phí)
MAX_TOKEN_BUDGET = "50000"

# OpenAI API Key cho Chat và Voice Call (set via: wrangler secret put OPENAI_API_KEY)
# Chat: gpt-4o-mini | Voice Call: gpt-4o-realtime-preview
# OPENAI_API_KEY = "sk-xxxx" (required)

# Admin Authentication (standalone - không cần database)
# Đổi password này thành password riêng của bạn!
ADMIN_PASSWORD = "BanDongHanh2024@Admin"
# JWT Secret - đổi thành chuỗi ngẫu nhiên riêng!
JWT_SECRET = "ban-dong-hanh-secret-key-change-me-in-production"
